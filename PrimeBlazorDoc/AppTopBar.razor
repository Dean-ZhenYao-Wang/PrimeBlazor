@implements IAsyncDisposable
@inject IJSRuntime JS
<div class="layout-topbar">
    <a class="menu-button" @onclick="async(e)=>await menubuttonClick.InvokeAsync(e)"><i class="pi pi-bars"></i></a>
    <NavLink href="/" class="logo">
        <img alt="logo" src="./assets/images/primevue-logo.png">
    </NavLink>
    <div class="app-theme">
        <img src="demo/images/themes/@logoMap[theme]" />
    </div>

    <ul @ref="topbarMenu" class="topbar-menu">
        <li class="topbar-submenu">
            <a tabindex="0" @onclick="(e)=>toggleMenu(e, 0)">
                <span>Themes</span>
            </a>
            <transition name="p-connected-overlay" @onmouseenter="onMenuEnter">
                <ul style="display:@(activeMenuIndex==0?"block":"none")">
                    <li class="topbar-submenu-header">THEMING</li>
                    <li><router-link to="/theming"><i class="pi pi-fw pi-file" /><span>Guide</span></router-link></li>
                    <li><a href="https://www.primefaces.org/designer/primevue"><i class="pi pi-fw pi-palette" /><span>Designer</span></a></li>
                    <li><a href="https://www.primefaces.org/designer-vue"><i class="pi pi-fw pi-desktop" /><span>Visual Editor</span></a></li>
                    <li><router-link to="/icons"><i class="pi pi-fw pi-info-circle" /><span>Icons</span></router-link></li>
                    <li class="topbar-submenu-header">BOOTSTRAP</li>
                    <li><a @onclick='(e)=>changeThemeEvent(e, "bootstrap4-light-blue")'><img src="demo/images/themes/bootstrap4-light-blue.svg" alt="Blue Light" /><span>Blue Light</span></a></li>
                    <li><a @onclick='(e)=>changeThemeEvent(e, "bootstrap4-light-purple")'><img src="demo/images/themes/bootstrap4-light-purple.svg" alt="Purple Light" /><span>Purple Light</span></a></li>
                    <li><a @onclick='(e)=>changeThemeEvent(e, "bootstrap4-dark-blue", true)'><img src="demo/images/themes/bootstrap4-dark-blue.svg" alt="Blue Dark" /><span>Blue Dark</span></a></li>
                    <li><a @onclick='(e)=>changeThemeEvent(e, "bootstrap4-dark-purple", true)'><img src="demo/images/themes/bootstrap4-dark-purple.svg" alt="Purple Dark" /><span>Purple Dark</span></a></li>

                    <li class="topbar-submenu-header">MATERIAL DESIGN</li>
                    <li><a @onclick='(e)=>changeThemeEvent(e, "md-light-indigo")'><img src="demo/images/themes/md-light-indigo.svg" alt="Indigo Light" /><span>Indigo Light</span></a></li>
                    <li><a @onclick='(e)=>changeThemeEvent(e, "md-light-deeppurple")'><img src="demo/images/themes/md-light-deeppurple.svg" alt="Deep Purple Light" /><span>Deep Purple Light</span></a></li>
                    <li><a @onclick='(e)=>changeThemeEvent(e, "md-dark-indigo", true)'><img src="demo/images/themes/md-dark-indigo.svg" alt="Indigo Dark" /><span>Indigo Dark</span></a></li>
                    <li><a @onclick='(e)=>changeThemeEvent(e, "md-dark-deeppurple", true)'><img src="demo/images/themes/md-dark-deeppurple.svg" alt="Deep Purple Dark" /><span>Deep Purple Dark</span></a></li>

                    <li class="topbar-submenu-header">MATERIAL DESIGN COMPACT</li>
                    <li><a @onclick='(e)=>changeThemeEvent(e, "mdc-light-indigo")'><img src="demo/images/themes/md-light-indigo.svg" alt="Indigo Light" /><span>Indigo Light</span></a></li>
                    <li><a @onclick='(e)=>changeThemeEvent(e, "mdc-light-deeppurple")'><img src="demo/images/themes/md-light-deeppurple.svg" alt="Deep Purple Light" /><span>Deep Purple Light</span></a></li>
                    <li><a @onclick='(e)=>changeThemeEvent(e, "mdc-dark-indigo", true)'><img src="demo/images/themes/md-dark-indigo.svg" alt="Indigo Dark" /><span>Indigo Dark</span></a></li>
                    <li><a @onclick='(e)=>changeThemeEvent(e, "mdc-dark-deeppurple", true)'><img src="demo/images/themes/md-dark-deeppurple.svg" alt="Deep Purple Dark" /><span>Deep Purple Dark</span></a></li>

                    <li class="topbar-submenu-header">TAILWIND</li>
                    <li><a @onclick='(e)=>changeThemeEvent(e, "tailwind-light" )'><img src="demo/images/themes/tailwind-light.png" alt="Tailwind Light" /><span>Tailwind Light</span></a></li>

                    <li class="topbar-submenu-header">FLUENT UI</li>
                    <li><a @onclick='(e)=>changeThemeEvent(e, "fluent-light" )'><img src="demo/images/themes/fluent-light.png" alt="Fluent Light" /><span>Fluent Light</span></a></li>

                    <li class="topbar-submenu-header flex align-items-center">PRIMEONE 2022 <Tag CssClass="ml-3" value="NEW" rounded severity="success"></Tag></li>
                    <li><a @onclick='(e)=>changeThemeEvent(e, "lara-light-indigo")'><img src="demo/images/themes/lara-light-indigo.png" alt="Lara Light Indigo" /><span>Lara Light Indigo</span></a></li>
                    <li><a @onclick='(e)=>changeThemeEvent(e, "lara-light-blue")'><img src="demo/images/themes/lara-light-blue.png" alt="Lara Light Blue" /><span>Lara Light Blue</span></a></li>
                    <li><a @onclick='(e)=>changeThemeEvent(e, "lara-light-purple")'><img src="demo/images/themes/lara-light-purple.png" alt="Lara Light Purple" /><span>Lara Light Purple</span></a></li>
                    <li><a @onclick='(e)=>changeThemeEvent(e, "lara-light-teal")'><img src="demo/images/themes/lara-light-teal.png" alt="Lara Light Teal" /><span>Lara Light Teal</span></a></li>
                    <li><a @onclick='(e)=>changeThemeEvent(e, "lara-dark-blue")'><img src="demo/images/themes/lara-dark-blue.png" alt="Lara Dark Blue" /><span>Lara Dark Blue</span></a></li>
                    <li><a @onclick='(e)=>changeThemeEvent(e, "lara-dark-indigo")'><img src="demo/images/themes/lara-dark-indigo.png" alt="Lara Dark Indigo" /><span>Lara Dark Indigo</span></a></li>
                    <li><a @onclick='(e)=>changeThemeEvent(e, "lara-dark-purple")'><img src="demo/images/themes/lara-dark-purple.png" alt="Lara Dark Purple" /><span>Lara Dark Purple</span></a></li>
                    <li><a @onclick='(e)=>changeThemeEvent(e, "lara-dark-teal")'><img src="demo/images/themes/lara-dark-teal.png" alt="Lara Dark Teal" /><span>Lara Dark Teal</span></a></li>

                    <li class="topbar-submenu-header">PRIMEONE 2021</li>
                    <li><a @onclick='(e)=>changeThemeEvent(e, "saga-blue")'><img src="demo/images/themes/saga-blue.png" alt="Saga Blue" /><span>Saga Blue</span></a></li>
                    <li><a @onclick='(e)=>changeThemeEvent(e, "saga-green")'><img src="demo/images/themes/saga-green.png" alt="Saga Green" /><span>Saga Green</span></a></li>
                    <li><a @onclick='(e)=>changeThemeEvent(e, "saga-orange")'><img src="demo/images/themes/saga-orange.png" alt="Saga Orange" /><span>Saga Orange</span></a></li>
                    <li><a @onclick='(e)=>changeThemeEvent(e, "saga-purple")'><img src="demo/images/themes/saga-purple.png" alt="Saga Purple" /><span>Saga Purple</span></a></li>
                    <li><a @onclick='(e)=>changeThemeEvent(e, "vela-blue", true)'><img src="demo/images/themes/vela-blue.png" alt="Vela Blue" /><span>Vela Blue</span></a></li>
                    <li><a @onclick='(e)=>changeThemeEvent(e, "vela-green", true)'><img src="demo/images/themes/vela-green.png" alt="Vela Green" /><span>Vela Green</span></a></li>
                    <li><a @onclick='(e)=>changeThemeEvent(e, "vela-orange", true)'><img src="demo/images/themes/vela-orange.png" alt="Vela Orange" /><span>Vela Orange</span></a></li>
                    <li><a @onclick='(e)=>changeThemeEvent(e, "vela-purple", true)'><img src="demo/images/themes/vela-purple.png" alt="Vela Purple" /><span>Vela Purple</span></a></li>
                    <li><a @onclick='(e)=>changeThemeEvent(e, "arya-blue", true)'><img src="demo/images/themes/arya-blue.png" alt="Arya Blue" /><span>Arya Blue</span></a></li>
                    <li><a @onclick='(e)=>changeThemeEvent(e, "arya-green", true)'><img src="demo/images/themes/arya-green.png" alt="Arya Green" /><span>Arya Green</span></a></li>
                    <li><a @onclick='(e)=>changeThemeEvent(e, "arya-orange", true)'><img src="demo/images/themes/arya-orange.png" alt="Arya Orange" /><span>Arya Orange</span></a></li>
                    <li><a @onclick='(e)=>changeThemeEvent(e, "arya-purple", true)'><img src="demo/images/themes/arya-purple.png" alt="Arya Purple" /><span>Arya Purple</span></a></li>

                    <li class="topbar-submenu-header">PREMIUM</li>
                    <li><a @onclick='(e)=>changeThemeEvent(e,"soho-light")'><img src="demo/images/themes/soho-light.png" alt="Soho Light" /><span>Soho Light</span></a></li>
                    <li><a @onclick='(e)=>changeThemeEvent(e,"soho-dark", true)'><img src="demo/images/themes/soho-dark.png" alt="Soho Dark" /><span>Soho Dark</span></a></li>
                    <li><a @onclick='(e)=>changeThemeEvent(e,"mira")'><img src="demo/images/themes/mira.jpg" alt="Mira" /><span>Mira</span></a></li>
                    <li><a @onclick='(e)=>changeThemeEvent(e,"nano")'><img src="demo/images/themes/nano.jpg" alt="Nano" /><span>Nano</span></a></li>

                    <li class="topbar-submenu-header">LEGACY</li>
                    <li><a @onclick='(e)=>changeThemeEvent(e, "nova")'><img src="demo/images/themes/nova.png" alt="Nova" /><span>Nova</span></a></li>
                    <li><a @onclick='(e)=>changeThemeEvent(e, "nova-alt")'><img src="demo/images/themes/nova-alt.png" alt="Nova Alt" /><span>Nova Alt</span></a></li>
                    <li><a @onclick='(e)=>changeThemeEvent(e, "nova-accent")'><img src="demo/images/themes/nova-accent.png" alt="Nova Accent" /><span>Nova Accent</span></a></li>
                    <li><a @onclick='(e)=>changeThemeEvent(e, "nova-vue")'><img src="demo/images/themes/nova-vue.png" alt="Nova Vue" /><span>Nova Vue</span></a></li>
                    <li><a @onclick='(e)=>changeThemeEvent(e, "luna-amber", true)'><img src="demo/images/themes/luna-amber.png" alt="Luna Amber" /><span>Luna Amber</span></a></li>
                    <li><a @onclick='(e)=>changeThemeEvent(e, "luna-blue", true)'><img src="demo/images/themes/luna-blue.png" alt="Luna Blue" /><span>Luna Blue</span></a></li>
                    <li><a @onclick='(e)=>changeThemeEvent(e, "luna-green", true)'><img src="demo/images/themes/luna-green.png" alt="Luna Green" /><span>Luna Green</span></a></li>
                    <li><a @onclick='(e)=>changeThemeEvent(e, "luna-pink", true)'><img src="demo/images/themes/luna-pink.png" alt="Luna Pink" /><span>Luna Pink</span></a></li>
                    <li><a @onclick='(e)=>changeThemeEvent(e, "rhea")'><img src="demo/images/themes/rhea.png" alt="Rhea" /><span>Rhea</span></a></li>
                </ul>
            </transition>
        </li>
        <li class="topbar-submenu">
            <a tabindex="0" @onclick="(e)=>toggleMenu(e, 1)">Templates</a>
            <transition name="p-connected-overlay" @onmouseenter="onMenuEnter">
                <ul style="display:@(activeMenuIndex==1?"block":"none")">
                    <li class="topbar-submenu-header">FREE ADMIN TEMPLATE</li>
                    <li><a href="https://www.primefaces.org/sakai-vue"><img src="./assets/images/layouts/themeswitcher-sakai.svg" alt="Sakai" /><span>Sakai</span></a></li>
                    <li class="topbar-submenu-header">PREMIUM ADMIN TEMPLATES</li>
                    <li><a href="https://www.primefaces.org/layouts/atlantis-vue"><img src="./assets/images/layouts/themeswitcher-atlantis.svg" alt="Atlantis" /><span>Atlantis</span></a></li>
                    <li><a href="https://www.primefaces.org/layouts/freya-vue"><img src="./assets/images/layouts/themeswitcher-freya.png" alt="Freya" /><span>Freya</span></a></li>
                    <li><a href="https://www.primefaces.org/layouts/diamond-vue"><img src="./assets/images/layouts/themeswitcher-diamond.png" alt="Diamond" /><span>Diamond</span></a></li>
                    <li><a href="https://www.primefaces.org/layouts/sapphire-vue"><img src="./assets/images/layouts/themeswitcher-sapphire.png" alt="Sapphire" /><span>Sapphire</span><span class="theme-badge material">material</span></a></li>
                    <li><a href="https://www.primefaces.org/layouts/serenity-vue"><img src="./assets/images/layouts/themeswitcher-serenity.png" alt="Serenity" /><span>Serenity</span><span class="theme-badge material">material</span></a></li>
                    <li><a href="https://www.primefaces.org/layouts/ultima-vue"><img src="./assets/images/layouts/themeswitcher-ultima.png" alt="Ultima" /><span>Ultima</span><span class="theme-badge material">material</span></a></li>
                    <li><a href="https://www.primefaces.org/layouts/avalon-vue"><img src="./assets/images/layouts/themeswitcher-avalon.png" alt="Avalon" /><span>Avalon</span><span class="theme-badge bootstrap">bootstrap</span></a></li>
                    <li><a href="https://www.primefaces.org/layouts/babylon-vue"><img src="./assets/images/layouts/themeswitcher-babylon.png" alt="Babylon" /><span>Babylon</span></a></li>
                    <li><a href="https://www.primefaces.org/layouts/apollo-vue"><img src="./assets/images/layouts/themeswitcher-apollo.png" alt="Apollo" /><span>Apollo</span><span class="theme-badge darkmode">dark mode</span></a></li>
                    <li><a href="https://www.primefaces.org/layouts/roma-vue"><img src="./assets/images/layouts/themeswitcher-roma.jpg" alt="Roma" /><span>Roma</span></a></li>
                    <li><a href="https://www.primefaces.org/layouts/prestige-vue"><img src="./assets/images/layouts/themeswitcher-prestige.png" alt="Prestige" /><span>Prestige</span></a></li>
                </ul>
            </transition>
        </li>
        <li class="topbar-submenu topbar-resources-submenu">
            <a href="https://www.primefaces.org/primeblocks-vue/#/" target="_blank"><span>Blocks</span></a>
        </li>
        <li class="topbar-submenu">
            <a tabindex="0" @onclick="(e)=>toggleMenu(e, 3)">v2.10.4</a>
            <transition name="p-connected-overlay" @onmouseenter="onMenuEnter">
                <ul style="display:@(activeMenuIndex==3?"block":"none");width: 100%">
                    <li><NavLink href="/"><span class="m-0">v2.10.4</span></NavLink></li>
                    <li><a href="https://www.primefaces.org/primevue"><span class="m-0">v3</span></a></li>
                </ul>
            </transition>
        </li>
    </ul>
</div>
@code {
    [Parameter] public EventCallback<MouseEventArgs> menubuttonClick { get; set; }
    [Parameter] public string? theme { get; set; }
    [Parameter] public EventCallback<(string theme, bool dark)> changeTheme { get; set; }
    private int? activeMenuIndex = null;
    private ElementReference topbarMenu;
    private Dictionary<string, string> logoMap = new Dictionary<string, string>
    {
               { "bootstrap4-light-blue", "bootstrap4-light-blue.svg"},
               {"bootstrap4-light-purple", "bootstrap4-light-purple.svg"},
               {"bootstrap4-dark-blue", "bootstrap4-dark-blue.svg"},
               {"bootstrap4-dark-purple", "bootstrap4-dark-purple.svg"},
               {"md-light-indigo", "md-light-indigo.svg"},
               {"md-light-deeppurple", "md-light-deeppurple.svg"},
               {"md-dark-indigo", "md-dark-indigo.svg"},
               {"md-dark-deeppurple", "md-dark-deeppurple.svg"},
               {"mdc-light-indigo", "md-light-indigo.svg"},
               {"mdc-light-deeppurple", "md-light-deeppurple.svg"},
               {"mdc-dark-indigo", "md-dark-indigo.svg"},
               {"mdc-dark-deeppurple", "md-dark-deeppurple.svg"},
               {"lara-dark-indigo", "lara-dark-indigo.png"},
               {"lara-dark-blue", "lara-dark-blue.png"},
               {"lara-dark-purple", "lara-dark-purple.png"},
               {"lara-dark-teal", "lara-dark-teal.png"},
               {"lara-light-indigo", "lara-light-indigo.png"},
               {"lara-light-blue", "lara-light-blue.png"},
               {"lara-light-purple", "lara-light-purple.png"},
               {"lara-light-teal", "lara-light-teal.png"},
               {"saga-blue", "saga-blue.png"},
               {"saga-green", "saga-green.png"},
               {"saga-orange", "saga-orange.png"},
               {"saga-purple", "saga-purple.png"},
               {"vela-blue", "vela-blue.png"},
               {"vela-green", "vela-green.png"},
               {"vela-orange", "vela-orange.png"},
               {"vela-purple", "vela-purple.png"},
               {"arya-blue", "arya-blue.png"},
               {"arya-green", "arya-green.png"},
               {"arya-orange", "arya-orange.png"},
               {"arya-purple", "arya-purple.png"},
               {"nova", "nova.png"},
               {"nova-alt", "nova-alt.png"},
               {"nova-accent", "nova-accent.png"},
               {"nova-vue", "nova-vue.png"},
               {"luna-blue", "luna-blue.png"},
               {"luna-green", "luna-green.png"},
               {"luna-pink", "luna-pink.png"},
               {"luna-amber", "luna-amber.png"},
               {"rhea", "rhea.png"},
               {"fluent-light", "fluent-light.png"},
               {"soho-light", "soho-light.png"},
               {"soho-dark", "soho-dark.png"},
               {"viva-light", "viva-light.svg"},
               {"viva-dark", "viva-dark.svg"},
               {"mira", "mira.jpg"},
               {"nano", "nano.jpg"},
               {"tailwind-light", "tailwind-light.png"}
    };
    private DotNetObjectReference<AppTopBar>? dotNetHelper;
    private IJSObjectReference? module;
    protected override async Task OnInitializedAsync()
    {
        dotNetHelper = DotNetObjectReference.Create(this);
        module = await JS.InvokeAsync<IJSObjectReference>("import", "./AppTopBar.razor.js");
        await JS.InvokeVoidAsync("AppTopBar.OnInitialized", dotNetHelper);
    }
    async ValueTask IAsyncDisposable.DisposeAsync()
    {
        if (module is not null)
            await module.DisposeAsync();
        dotNetHelper?.Dispose();
    }

    private async Task changeThemeEvent(MouseEventArgs mouseEvent, string theme, bool dark = false)
    {
        await changeTheme.InvokeAsync((theme, dark));
        this.activeMenuIndex = null;
    }
    private void toggleMenu(MouseEventArgs mouseEvent, int index)
    {
        this.activeMenuIndex = this.activeMenuIndex != null && this.activeMenuIndex.Value == index ? null : index;
    }

    [JSInvokable]
    public int? getActiveMenuIndex()
    {
        return this.activeMenuIndex;
    }
    [JSInvokable]
    public void setActiveMenuIndex(int value)
    {
        this.activeMenuIndex = value;
    }
    [JSInvokable]
    public ElementReference getTopbarMenu()
    {
        return this.topbarMenu;
    }
    private async Task onMenuEnter()
    {
        await JS.InvokeVoidAsync("AppTopBar.bindOutsideClickListener");
    }
}